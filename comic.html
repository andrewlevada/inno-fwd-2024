<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Assignment 2: Comic</title>

    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="layout-helper.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="page" class="flex col full-width">
    <h3>Assignment 2: Comic</h3>

    <div id="comic" class="flex col full-width">
        <div class="flex col">
            <img src="static/comic-placeholder.png" alt="loading comic...">
            <p class="title">Loading...</p>
            <p class="date"></p>
        </div>
    </div>
</div>

<script>
    async function getComicsData() {
        const idRequestParams = new URLSearchParams({ email: "a.levada@innopolis.university" });
        const idRequestHost = "https://fwd.innopolis.university/api/hw2";

        const comicId = await fetch(`${idRequestHost}?${idRequestParams.toString()}`)
            .then(response => response.text())
            .then(body => Number.parseInt(body));

        const comicRequestParams = new URLSearchParams({ id: comicId.toString() });
        const comicRequestHost = "https://fwd.innopolis.university/api/comic";

        return fetch(`${comicRequestHost}?${comicRequestParams.toString()}`)
            .then(response => response.json());
    }

    getComicsData().then(data => {
        const comicContainer = document.querySelector("#comic");

        const comicImage = comicContainer.querySelector("img");
        comicImage.src = data.img;
        comicImage.alt = data.alt;

        const comicTitle = comicContainer.querySelector(".title");
        comicTitle.textContent = data.safe_title;

        const comicDate = comicContainer.querySelector(".date");
        const date = new Date(data.year, data.month - 1, data.day);
        comicDate.textContent = date.toLocaleDateString();
    });
</script>

</body>
</html>
